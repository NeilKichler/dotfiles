#!/bin/bash
# ~/.local/bin/mpdmenu
# MPD Playlist view/selection (and Google Play Music integration) from dmenu

# Number of entries to display at once.
readonly lines=10

# Globally set dmenu font
read -r font < "${XDG_CONFIG_HOME:-$HOME/.config}"/dmenu/font
. "${XDG_CONFIG_HOME:-$HOME.config}"/dmenu/dmenucolors

puts() {
    printf -- "$1\n" "${@:2}"
}

create_list() {
    local number=1
    while read -r song; do
        playl[$song]=$number
	number=$((number + 1))
    done
}

get_user_picks() {
	local current 
	current="$(mpc current)"
	opts+=( -l $lines -p "Play" -I "${playl[$current]}" )
	puts '%s' "${!playl[@]}" | bemenu "${opts[@]}"
}   

declare -A playl
create_list < <(mpc playlist)

results="$(get_user_picks)"

if [[ -n "$results" ]]; then
    mpc play "${playl[$results]}"
fi
