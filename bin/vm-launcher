#!/usr/bin/env bash

readonly confdir=~/local/cfg
readonly optsdir=$confdir/dmenu/bemenucolors

VMDIR=~/media/vm

list_items() {
  cd $VMDIR
  for i in *; do
    printf '%s\n' "$i"
  done | bemenu "${opts[@]}" -l $(find "$VMDIR" | wc -l )
}

## Main
if [[ -s $confdir/dmenu/font ]]; then
  read -r font < "$confdir"/dmenu/font
  opts+=(-fn "$font")
fi

if [[ -s $optsdir ]]; then
  source "$optsdir"
fi

result=$(list_items)
[[ $result ]] && qemu-system-x86_64 -drive file=media/vm/"$result",format=raw -cdrom media/iso/"$result".iso -enable-kvm -m 2046
