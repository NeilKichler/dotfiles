#!/usr/bin/env bash
# Cheapo url spawner for st

readonly confdir=${XDG_CONFIG_HOME:-$HOME/local/cfg}
readonly optsfile=$confdir/dmenu/bemenucolors

# https://github.com/mvdan/xurls
# https://github.com/Cloudef/bemenu
# Doesn't yet deal well with line wraps, etc.

create_menu() {
    xurls "$@" | tac | bemenu -l 10 "${opts[@]}" -p URLs
}

# https://github.com/halfwit/dotfiles/blob/master/.config/dmenu/font
if [[ -s $confdir/dmenu/font ]]; then
    read -r font < "$confdir"/dmenu/font
fi

if [[ $font ]]; then
    opts+=(-fn "$font")
fi

if [[ -s $optsfile ]]; then
    source "$optsfile"
fi

result=$(create_menu "$@")
if [[ "$result" ]]; then
    plumber "$result"
fi
