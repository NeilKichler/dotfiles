#!/usr/bin/env bash
# Write/remove a task to do later.

readonly optsfile=$XDG_CONFIG_HOME/dmenu/bemenucolors

create_menu() {
  cd $XDG_CACHE_HOME/todo
  for i in *; do 
    if [[ -s $i ]]; then 
      printf '%s\n' "$i"
    else 
      rm "$i"
    fi
  done
}

menu() {
  create_menu | bemenu -l $(ls "$XDG_CACHE_HOME/todo" | wc -l ) "${opts[@]}" -p "Select or create new task: "
}

## Main

[[ -s $optsfile ]] && source "$optsfile"

result=$(menu)
[[ ! $result ]] && exit 

touch "$XDG_CACHE_HOME/todo/$result"
exec ~/local/share/todo/singletask "$result"
