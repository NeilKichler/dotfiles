#!/usr/bin/env bash

# Code search using bemenu (single string)
# Requires bemenu, tree, neovim, and python

readonly optsfile=$XDG_CONFIG_HOME/dmenu/bemenucolors

# Whilelist of locations to search
readonly locations=( ~/programming \
                     ~/local/cfg   \
                     ~/local/bin   \
                     ~/local/share
);

get_selection() {
    opts+=( -l 10 -p "Select file to edit: " )
    grep -Iri "$1" "${locations[@]}" --exclude="*.git" | bemenu "${opts[@]}"

}

# Main

# Configuration

[[ -s $optsfile ]] && source "$optsfile"

# Chain multiple arguments like.*this for grep
token="$*"
result=$(get_selection "${token// /.\*}")

# Verify a selection was made
if [[ $result ]]; then
    exec plumber "${result%:*}"
fi
